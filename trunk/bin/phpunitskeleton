#! /usr/bin/php -d safe_mode=Off
<?php
$librarypath = '~/workspace/trunk/library';

require_once 'Zend/Console/Getopt.php';
$getopt = new Zend_Console_Getopt(array('class|c=s' => 'class name'));

$class = $getopt->c;
if($class == "") throw new Exception("invalid option, must use -c");
chdir($librarypath);
exec("phpunit --skeleton $class");

$classPath = realpath($librarypath.DIRECTORY_SEPARATOR.preg_replace('/_/', '/', $class).'.php');

$skeletonPath = dirname($classPath).DIRECTORY_SEPARATOR.$class.'Test.php';

$destDir = dirname(preg_replace('/library/', 'tests', $classPath));

//if(!opendir($classPath))
//throw new RuntimeException($destDir.'というディレクトリがありません！！！！！！！！！');

$newfileName = substr(strrchr($class, '_'), 1).'Test.php';

if(!$boolean = rename($skeletonPath,
                      $destDir.DIRECTORY_SEPARATOR.$newfileName)) {
                      throw new Exception('rename sippai!');
}

echo 'ok! Test File is created :', $destDir.DIRECTORY_SEPARATOR.$newfileName, PHP_EOL;
